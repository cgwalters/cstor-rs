# AI Coding Notes

This document captures issues encountered when using agentic AI coding assistants on this project, to help avoid similar problems in the future.

## Percentage coverage masking bugs

**Context**: This project parses tar-split metadata files to reconstruct tar archives bit-for-bit. The tar-split format stores segment data (tar headers, padding) interleaved with file content references. A Table of Contents (TOC) is generated by walking the tar-split entries.

**Issue**: When writing integration tests, the AI used percentage-based coverage thresholds (e.g., "90% coverage") rather than exact matching. This approach masked a bug in the tar-split parsing code where files like `etc/passwd`, `etc/shadow`, and `lib64` were missing from the TOC.

The test passed because 97% of files were present, but the missing 3% represented a real bug: the tar-split segment parser was not correctly handling padding bytes after file content, causing subsequent file headers to be missed.

**Resolution**: The parser was fixed to properly handle tar block padding (512-byte alignment). The bug was in segment boundary detection.

**Lesson**: Tests comparing two sets of files should require exact matches, not percentage thresholds. If there's a mismatch, it's a bug that needs investigation, not noise to be tolerated. Use `assert_eq!(expected_files, actual_files)` instead of coverage percentages.
